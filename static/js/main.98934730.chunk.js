(this["webpackJsonpreact-ws-chat"]=this["webpackJsonpreact-ws-chat"]||[]).push([[0],{79:function(e,t,n){e.exports=n(97)},84:function(e,t,n){},96:function(e,t,n){},97:function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),c=n(30),l=n.n(c),i=(n(84),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,152)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,o=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),o(e),c(e)}))}),s=n(33),u=n.n(s),m=n(45),d=n(13),f=n(145),g=n(147),p=n(14),v=n(43);a=r.createContext(void 0);var E,h={me:{name:""},messages:[],messageValue:"",nameValue:"",isLoading:!1,isConnected:!1},y=function(e,t){switch(t.type){case"set_me":case"set_loading":case"set_message_value":case"set_name_value":case"set_connected":return Object(v.a)(Object(v.a)({},e),t.payload);case"set_messages":return Object(v.a)(Object(v.a)({},e),{},{messages:[].concat(Object(p.a)(e.messages),[t.payload.messages])});default:throw new Error}},b=function(e){return{type:"set_connected",payload:{isConnected:e}}},O=function(e){return{type:"set_loading",payload:{isLoading:e}}},C=function(e){return{type:"set_message_value",payload:{messageValue:e}}},w=function(e){return{type:"set_messages",payload:{messages:e}}};!function(e){e.MESSAGE="message",e.QUIT="quit",e.CONNECTION="connection"}(E||(E={}));var j=n(141),N=Object(j.a)({root:{justifyContent:"center"},title:{display:"grid",gridTemplateRows:"1fr 1fr"}}),_=function(){var e=Object(r.useContext)(a),t=Object(d.a)(e,3),n=(t[0],t[1],t[2],N());return r.createElement(f.a,{color:"transparent",variant:"outlined",position:"static"},r.createElement(g.a,{className:n.root},r.createElement("div",{className:n.title},r.createElement("strong",null,"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0438 \u0428\u0430\u043b\u0442\u0430\u0439 \u0411\u043e\u043b\u0442\u0430\u044f"))))},T=n(15),S=n(148),x=n(144),V=n(140),k=n(142),I=n(149),F=function(e){return r.createElement(S.a,null,r.createElement(x.a,{container:!0,alignItems:"center",justifyContent:"center",style:{height:window.innerHeight-30}},r.createElement(I.a,{color:"primary"})))},J=Object(j.a)({info:{color:"#afbed2",margin:"20px 30px"}}),L=(n(150),[{path:"/CHAT_ROUTE",Component:function(e){var t=Object(r.useContext)(a),n=Object(d.a)(t,3),o=n[0],c=n[1],l=n[2],i=Object(r.useRef)(null),s=J();Object(r.useEffect)((function(){!function(){var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[o]);return o.isLoading?r.createElement(F,null):r.createElement(S.a,null,r.createElement(x.a,{container:!0,alignItems:"center",style:{maxHeight:window.innerHeight-30}},r.createElement("div",{style:{width:"80%",height:"70vh",backgroundColor:"#354765",overflowY:"auto"}},o.messages.length&&o.messages.map((function(e){var t=o.nameValue===e.name,n={minWidth:"20vw",margin:10,backgroundColor:t?"#3a64a8":"#224e94",color:"#ffffff",borderRadius:"4%",marginLeft:t?"auto":"10%",marginRight:t?"10%":0,maxWidth:"40%",width:"fit-content",padding:15,display:"grid",rowGap:20,fontFamily:"serif","&:first-child":{fontFamily:"sans-serif"}};return r.createElement(x.a,{key:e.id,direction:"column",container:!0},e.event===E.MESSAGE?r.createElement("div",{style:n},r.createElement("h3",null,e.name),r.createElement("span",null,e.body)):e.event===E.CONNECTION?r.createElement("span",{className:s.info},e.name," \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a \u0447\u0430\u0442\u0443.. ."):r.createElement("span",{className:s.info},e.name," \u0432\u044b\u0448\u0435\u043b \u0438\u0437 \u0447\u0430\u0442\u0430.. ."),r.createElement("div",{ref:i}))}))),r.createElement(x.a,{container:!0,direction:"column",alignItems:"flex-end",style:{width:"80%",rowGap:20,color:"#ffffff"}},r.createElement(V.a,{variant:"filled",onChange:function(e){return c(C(e.currentTarget.value))},value:o.messageValue,fullWidth:!0}),r.createElement(k.a,{style:{backgroundColor:"#354765",color:"#ffffff"},onClick:function(){var e,t={event:"message",id:Date.now().toString(),name:o.me.name,body:o.messageValue};null===l||void 0===l||l.send(JSON.stringify(t)),c(C("")),null===(e=i.current)||void 0===e||e.scrollTo(0,i.current.scrollHeight)},variant:"outlined"},"send"))))}}]),R=function(){return r.createElement(T.d,null,L.map((function(e){var t=e.path,n=e.Component;return r.createElement(T.b,{key:t,path:t,component:n,exact:!0})})),r.createElement(T.a,{to:"/CHAT_ROUTE"}))},H=(n(96),n(54)),A=function(){var e,t=Object(r.useReducer)(y,h),n=Object(d.a)(t,2),o=n[0],c=n[1],l=Object(r.useState)(null),i=Object(d.a)(l,2),s=i[0],f=i[1],g=r.useMemo((function(){return[o,c,s]}),[o,s]),p=function(){var e=Object(m.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c({type:"set_me",payload:{me:{id:Date.now().toString(),name:o.nameValue}}});case 2:return c(O(!0)),e.t0=f,e.next=6,new WebSocket("ws://ws-simple-chat-api.herokuapp.com");case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(s&&(s.onmessage=function(e){c(w(JSON.parse(e.data)))},s.onopen=function(){c(b(!0));var e={event:E.CONNECTION,id:o.me.id,name:o.nameValue,body:""};null===s||void 0===s||s.send(JSON.stringify(e)),c(O(!1)),console.log("ws on")},s.onmessage=function(e){var t=JSON.parse(e.data);c(w(t)),console.log("message send")},s.onclose=function(){c(b(!1));var e={event:E.CONNECTION,id:o.me.id,name:o.nameValue,body:""};console.log("ws close"),s.send(JSON.stringify(e))},s.onerror=function(){c(b(!1)),setTimeout((function(){return p()}),1e3),console.log("ws error")}),o.isLoading)return r.createElement(F,null);var v=(null===(e=o.nameValue)||void 0===e?void 0:e.trim().length)<3;return r.createElement(H.a,null,r.createElement(a.Provider,{value:g},r.createElement(_,null),o.isConnected?r.createElement(R,null):r.createElement(r.Fragment,null,r.createElement(x.a,{container:!0,justifyContent:"center",alignItems:"stretch"},r.createElement(V.a,{variant:"filled",onChange:function(e){return c(function(e){return{type:"set_name_value",payload:{nameValue:e}}}(e.currentTarget.value))},value:o.nameValue}),r.createElement(k.a,{disabled:v,color:"info",onClick:p,variant:"contained"},"connect")))))};l.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(A,null)),document.getElementById("root")),i()}},[[79,1,2]]]);
//# sourceMappingURL=main.98934730.chunk.js.map