(this["webpackJsonpreact-ws-chat"]=this["webpackJsonpreact-ws-chat"]||[]).push([[0],{114:function(e,t,n){},125:function(e,t,n){},126:function(e,t,n){"use strict";n.r(t);var a,i=n(0),s=n.n(i),c=n(28),o=n.n(c),r=(n(114),function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,184)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),s(e),c(e)}))}),u=n(46),l=n.n(u),d=n(62),j=n(13),m=n(177),b=n(179),f=n(173),O=Object(f.a)({root:{justifyContent:"space-around",display:"flex",columnGap:30,flexWrap:"wrap",rowGap:4,margin:"8px 0"},title:{display:"grid",gridTemplateRows:"1fr 1fr",justifyItems:"flex-end"},onlineCounter:{color:"grey"}});a=i.createContext(undefined);var h,g=n(30),p=Object(f.a)({timeRoot:{fontSize:24,fontFamily:"monospace",color:"gray",whiteSpace:"nowrap"}}),x=function(e){var t=function(e){var t=e.toString();return t.length>1?t:"0".concat(t)},n=t(e.getHours()),a=t(e.getMinutes()),i=t(e.getSeconds());return"".concat(n,": ").concat(a,": ").concat(i)},v=function(e){var t=new Date(e/1e3),n=t.getFullYear(),a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()];return t.getDate()+" "+a+" "+n+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},C=n(2),y=function(e){e.children;var t=Object(i.useState)(new Date),n=Object(j.a)(t,2),a=n[0],s=n[1],c=p();return Object(i.useEffect)((function(){var e=setTimeout((function(){return s(new Date)}),5e3);return function(){return clearInterval(e)}}),[a]),Object(C.jsx)("div",{className:c.timeRoot,children:x(a)})},w=Object(g.a)((function(e){var t=Object(i.useContext)(a),n=Object(j.a)(t,2),s=n[0],c=(n[1],s.connectionCounter),o=O();return Object(C.jsx)(m.a,{color:"transparent",variant:"outlined",elevation:0,position:"static",children:Object(C.jsxs)(b.a,{className:o.root,children:[Object(C.jsx)("div",{}),Object(C.jsxs)("div",{className:o.title,children:[Object(C.jsx)("strong",{children:"\u0416\u0438\u0432\u044b\u0435 \u0438 \u043f\u0440\u043e\u0447\u0438\u0435".toUpperCase()}),Object(C.jsxs)("span",{className:o.onlineCounter,children:["\u0441\u0435\u0439\u0447\u0430\u0441 \u043e\u043d\u043b\u0430\u0439\u043d: ",c||0," \u0447\u0435\u043b\u043e\u0432\u0435\u043a "]})]}),Object(C.jsx)(y,{})]})})})),N=n(16),S=n(180),k=n(176),M=n(172),V=n(174),T=n(181),E=function(e){return Object(C.jsx)(S.a,{children:Object(C.jsx)(k.a,{container:!0,alignItems:"center",justifyContent:"center",style:{height:window.innerHeight-30},children:Object(C.jsx)(T.a,{color:"primary"})})})},I=Object(f.a)({messagesRoot:{maxHeight:window.innerHeight-30},messages:{width:"100%",height:"70vh",backgroundColor:"#354765",overflowY:"auto"},newMessageRoot:{position:"relative",width:"100%",rowGap:20,color:"#ffffff"},sendButton:{backgroundColor:"#354765",color:"#ffffff",width:"20%",height:56,"&:hover":{backgroundColor:"#7094d2",color:"#354765"}},textField:{width:"80%"}}),R=n(94),F=n.n(R),L=n(5),D=Object(f.a)(Object(L.a)({mainBlock:{minWidth:"40vw",margin:10,borderRadius:"4%",maxWidth:"60%",width:"fit-content",padding:15,display:"grid",justifyContent:"flexStart",rowGap:20,fontFamily:"serif",position:"relative"},info:{color:"#afbed2",margin:"20px 30px"},name:{display:"block",maxWidth:"max-content"},copy:{cursor:"pointer",position:"absolute",opacity:.7,top:8},date:{fontSize:"0.7em"}},"@media (max-width:".concat(520,"px)"),{mainBlock:{minWidth:"70vw",fontSize:"1.4em"}})),J=n(14),B=n(43),W=n(44),A=n(18);!function(e){e.MESSAGE="message",e.QUIT="quit",e.CONNECTION="connection"}(h||(h={}));var H=function(){function e(){Object(B.a)(this,e),this.messages=[],this.messageValue="",this.nameValue="",this.isLoading=!1,this.isConnected=!1,this.connectionCounter=0,Object(A.d)(this,{},{deep:!0})}return Object(W.a)(e,[{key:"setConnected",value:function(e){this.isConnected=e}},{key:"setLoading",value:function(e){this.isLoading=e}},{key:"setMessageValue",value:function(e){this.messageValue=e}},{key:"setNameValue",value:function(e){this.nameValue=e}},{key:"setMessages",value:function(e){this.messages=[].concat(Object(J.a)(this.messages),Object(J.a)(e))}},{key:"setConnectionCounter",value:function(e){this.connectionCounter=e}}]),e}(),G=Object(g.a)((function(e){var t=e.isMe,n=e.message,a=Object(i.useState)((function(){return new H})),s=Object(j.a)(a,1)[0],c=D();n.event===h.CONNECTION&&s.setConnectionCounter(n.connectionCounter);var o={backgroundColor:t?"#3a64a8":"#536f9b",color:t?"#f6dbaa":"#eee4cc",marginLeft:t?"auto":"10%",marginRight:t?"10%":0,paddingRight:10};return Object(C.jsx)(k.a,{direction:"column",container:!0,children:n.event===h.MESSAGE?Object(C.jsxs)("div",{className:c.mainBlock,style:o,children:[Object(C.jsx)("h3",{className:c.name,style:{justifySelf:"".concat(!t&&"flex-end"),borderBottom:"2px solid ".concat(t?"#f6dbaa":"#eee4cc")},children:n.name.toUpperCase()}),Object(C.jsx)("span",{children:n.body}),Object(C.jsx)("span",{className:c.date,children:v(1e3*n.date)}),Object(C.jsx)("div",{onClick:function(){return navigator.clipboard.writeText(n.body)},style:t?{right:2}:{left:6},title:"\u0441\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",className:c.copy,children:Object(C.jsx)(F.a,{})})]}):n.event===h.CONNECTION?Object(C.jsxs)("span",{className:c.info,children:[n.name," \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a \u0447\u0430\u0442\u0443.. ."]}):Object(C.jsxs)("span",{className:c.info,children:[n.name," \u0432\u044b\u0448\u0435\u043b \u0438\u0437 \u0447\u0430\u0442\u0430.. ."]})},n.id)})),P=n(95),U=n.n(P),_=n(81),z=n.n(_),K=n(96),Y=n.n(K),q=Object(f.a)({emojiRoot:{position:"absolute",zIndex:1,top:10},picker:{top:-350}}),Q=Object(g.a)((function(e){e.children;var t=e.frameWidth,n=void 0===t?0:t,s=Object(i.useContext)(a),c=Object(j.a)(s,2),o=c[0],r=(c[1],q()),u=Object(i.useState)(!1),l=Object(j.a)(u,2),d=l[0],m=l[1];return Object(C.jsx)("div",{style:{right:"".concat(.2*n,"px")},className:U()(r.emojiRoot,Object(L.a)({},r.picker,d)),onBlur:function(){return m(!1)},children:d?Object(C.jsx)(z.a,{native:!0,groupNames:{smileys_people:"PEOPLE"},disableAutoFocus:!0,onEmojiClick:function(e,t){o.setMessageValue(t.emoji)},skinTone:_.SKIN_TONE_MEDIUM_DARK}):Object(C.jsx)(V.a,{onClick:function(){return m(!0)},children:Object(C.jsx)(Y.a,{})})})})),X=n(67),Z=Object(g.a)((function(e){var t,n=Object(i.useContext)(a),s=Object(j.a)(n,2),c=s[0],o=s[1],r=Object(i.useRef)(null),u=I(),l=Object(X.a)({initialValues:{message:"\u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435"},onSubmit:function(e){return function(){if(c.messageValue.trim()){var e={event:"message",id:Date.now().toString(),name:c.me.name,body:c.messageValue};null===o||void 0===o||o.send(JSON.stringify(e)),c.setMessageValue("")}}()}}),d=c.messages.length;return Object(i.useEffect)((function(){!function(){var e;null===(e=r.current)||void 0===e||e.scrollTo(0,r.current.scrollHeight)}()})),c.isLoading?Object(C.jsx)(E,{}):Object(C.jsx)(S.a,{children:Object(C.jsxs)("form",{onSubmit:l.handleSubmit,children:[Object(C.jsx)(k.a,{container:!0,className:u.messagesRoot,alignItems:"center",children:Object(C.jsx)(k.a,{ref:r,className:u.messages,children:d&&c.messages.map((function(e){var t=c.nameValue===e.name;return Object(C.jsx)(G,{isMe:t,message:e},e.id)}))})}),Object(C.jsxs)(k.a,{className:u.newMessageRoot,container:!0,direction:"row",alignItems:"flex-end",children:[Object(C.jsx)(M.a,{id:"message",name:"message",label:"message",variant:"filled",autoComplete:"off",onChange:function(e){return c.setMessageValue(e.currentTarget.value)},value:c.messageValue,className:u.textField}),Object(C.jsx)(Q,{frameWidth:null===(t=r.current)||void 0===t?void 0:t.clientWidth}),Object(C.jsx)(V.a,{type:"submit",variant:"outlined",classes:{outlined:u.sendButton},children:Object(C.jsx)("strong",{children:"send"})})]})]})})})),$=(n(182),"/CHAT_ROUTE"),ee=[{path:$,Component:Z}],te=function(){return Object(C.jsxs)(N.d,{children:[ee.map((function(e){var t=e.path,n=e.Component;return Object(C.jsx)(N.b,{path:t,component:n,exact:!0},t)})),Object(C.jsx)(N.a,{to:$})]})},ne=(n(125),n(76)),ae=function(){function e(){Object(B.a)(this,e),this.me={name:""},Object(A.d)(this,{},{deep:!0})}return Object(W.a)(e,[{key:"setMe",value:function(e){this.me=e}}]),e}(),ie=Object(g.a)((function(){var e,t=Object(i.useState)((function(){return new H})),n=Object(j.a)(t,1)[0],s=Object(i.useState)((function(){return new ae})),c=Object(j.a)(s,1)[0],o=Object(i.useState)(null),r=Object(j.a)(o,2),u=r[0],m=r[1],b=i.useMemo((function(){return[n,u]}),[n,u]),f=function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c.setMe({id:Date.now().toString(),name:n.nameValue}),n.setLoading(!0),e.t0=m,e.next=5,new WebSocket("wss://ws-simple-chat-api.herokuapp.com");case 5:e.t1=e.sent,(0,e.t0)(e.t1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=Object(X.a)({initialValues:{name:"\u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0430\u0448\u0435 \u0438\u043c\u044f"},onSubmit:function(e){return f()}});if(u&&(u.onmessage=function(e){n.setMessages(JSON.parse(e.data))},u.onopen=function(){n.setConnected(!0);var e={event:h.CONNECTION,id:c.me.id,name:n.nameValue,body:""};null===u||void 0===u||u.send(JSON.stringify(e)),n.setLoading(!1)},u.onmessage=function(e){var t=JSON.parse(e.data);n.setMessages(t)},u.onclose=function(){n.setConnected(!1);var e={event:h.CONNECTION,id:c.me.id,name:n.nameValue,body:""};u.send(JSON.stringify(e))},u.onerror=function(){n.setConnected(!1),setTimeout((function(){return f()}),1e3)}),n.isLoading)return Object(C.jsx)(E,{});var g=(null===(e=n.nameValue)||void 0===e?void 0:e.trim().length)<3;return Object(C.jsx)(ne.a,{children:Object(C.jsxs)(a.Provider,{value:b,children:[Object(C.jsx)(w,{}),n.isConnected?Object(C.jsx)(te,{}):Object(C.jsx)("form",{onSubmit:O.handleSubmit,children:Object(C.jsxs)(k.a,{container:!0,justifyContent:"center",alignItems:"stretch",children:[Object(C.jsx)(M.a,{variant:"filled",onChange:function(e){return n.setNameValue(e.currentTarget.value)},value:n.nameValue,id:"name",name:"name",label:"name"}),Object(C.jsx)(V.a,{type:"submit",disabled:g,color:"info",variant:"contained",children:"connect"})]})})]})})})),se=ie;o.a.render(Object(C.jsx)(s.a.StrictMode,{children:Object(C.jsx)(se,{})}),document.getElementById("root")),r()}},[[126,1,2]]]);
//# sourceMappingURL=main.997c3e60.chunk.js.map