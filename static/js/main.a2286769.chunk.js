(this["webpackJsonpreact-ws-chat"]=this["webpackJsonpreact-ws-chat"]||[]).push([[0],{83:function(e,n,t){},95:function(e,n,t){},96:function(e,n,t){"use strict";t.r(n);var a,s=t(0),c=t.n(s),r=t(30),o=t.n(r),i=(t(83),function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,151)).then((function(n){var t=n.getCLS,a=n.getFID,s=n.getFCP,c=n.getLCP,r=n.getTTFB;t(e),a(e),s(e),c(e),r(e)}))}),l=t(33),u=t.n(l),d=t(45),j=t(13),f=t(144),m=t(146),g=t(14),b=t(43);a=s.createContext(undefined);var O,h={me:{name:""},messages:[],messageValue:"",nameValue:"",isLoading:!1,isConnected:!1},p=function(e,n){switch(n.type){case"set_me":case"set_loading":case"set_message_value":case"set_name_value":case"set_connected":return Object(b.a)(Object(b.a)({},e),n.payload);case"set_messages":return Object(b.a)(Object(b.a)({},e),{},{messages:[].concat(Object(g.a)(e.messages),[n.payload.messages])});default:throw new Error}},v=function(e){return{type:"set_connected",payload:{isConnected:e}}},x=function(e){return{type:"set_loading",payload:{isLoading:e}}},y=function(e){return{type:"set_message_value",payload:{messageValue:e}}},w=function(e){return{type:"set_messages",payload:{messages:e}}};!function(e){e.MESSAGE="message",e.QUIT="quit",e.CONNECTION="connection"}(O||(O={}));var C=t(140),N=Object(C.a)({root:{justifyContent:"center"},title:{display:"grid",gridTemplateRows:"1fr 1fr"}}),_=t(2),S=function(){var e=Object(s.useContext)(a),n=Object(j.a)(e,3),t=(n[0],n[1],n[2],N());return Object(_.jsx)(f.a,{color:"transparent",variant:"outlined",position:"static",children:Object(_.jsx)(m.a,{className:t.root,children:Object(_.jsx)("div",{className:t.title,children:Object(_.jsx)("strong",{children:"\u0414\u043e\u0431\u0440\u043e \u043f\u043e\u0436\u0430\u043b\u043e\u0432\u0430\u0442\u044c \u0438\u043c\u0435\u043d\u0438 \u0428\u0430\u043b\u0442\u0430\u0439 \u0411\u043e\u043b\u0442\u0430\u044f"})})})})},T=t(15),V=t(147),E=t(143),I=t(139),k=t(141),F=t(148),J=function(e){return Object(_.jsx)(V.a,{children:Object(_.jsx)(E.a,{container:!0,alignItems:"center",justifyContent:"center",style:{height:window.innerHeight-30},children:Object(_.jsx)(F.a,{color:"primary"})})})},L=Object(C.a)({info:{color:"#afbed2",margin:"20px 30px"}}),R=(t(149),"/CHAT_ROUTE"),H=[{path:R,Component:function(e){var n=Object(s.useContext)(a),t=Object(j.a)(n,3),c=t[0],r=t[1],o=t[2],i=Object(s.useRef)(null),l=L();Object(s.useEffect)((function(){!function(){var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[c]);return c.isLoading?Object(_.jsx)(J,{}):Object(_.jsx)(V.a,{children:Object(_.jsxs)(E.a,{container:!0,alignItems:"center",style:{maxHeight:window.innerHeight-30},children:[Object(_.jsx)("div",{style:{width:"80%",height:"70vh",backgroundColor:"#354765",overflowY:"auto"},children:c.messages.length&&c.messages.map((function(e){var n=c.nameValue===e.name,t={minWidth:"20vw",margin:10,backgroundColor:n?"#3a64a8":"#224e94",color:"#ffffff",borderRadius:"4%",marginLeft:n?"auto":"10%",marginRight:n?"10%":0,maxWidth:"40%",width:"fit-content",padding:15,display:"grid",rowGap:20,fontFamily:"serif","&:first-child":{fontFamily:"sans-serif"}};return Object(_.jsxs)(E.a,{direction:"column",container:!0,children:[e.event===O.MESSAGE?Object(_.jsxs)("div",{style:t,children:[Object(_.jsx)("h3",{children:e.name}),Object(_.jsx)("span",{children:e.body})]}):e.event===O.CONNECTION?Object(_.jsxs)("span",{className:l.info,children:[e.name," \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0438\u043b\u0441\u044f \u043a \u0447\u0430\u0442\u0443.. ."]}):Object(_.jsxs)("span",{className:l.info,children:[e.name," \u0432\u044b\u0448\u0435\u043b \u0438\u0437 \u0447\u0430\u0442\u0430.. ."]}),Object(_.jsx)("div",{ref:i})]},e.id)}))}),Object(_.jsxs)(E.a,{container:!0,direction:"column",alignItems:"flex-end",style:{width:"80%",rowGap:20,color:"#ffffff"},children:[Object(_.jsx)(I.a,{variant:"filled",onChange:function(e){return r(y(e.currentTarget.value))},value:c.messageValue,fullWidth:!0}),Object(_.jsx)(k.a,{style:{backgroundColor:"#354765",color:"#ffffff"},onClick:function(){var e,n={event:"message",id:Date.now().toString(),name:c.me.name,body:c.messageValue};null===o||void 0===o||o.send(JSON.stringify(n)),r(y("")),null===(e=i.current)||void 0===e||e.scrollTo(0,i.current.scrollHeight)},variant:"outlined",children:"send"})]})]})})}}],G=function(){return Object(_.jsxs)(T.d,{children:[H.map((function(e){var n=e.path,t=e.Component;return Object(_.jsx)(T.b,{path:n,component:t,exact:!0},n)})),Object(_.jsx)(T.a,{to:R})]})},M=(t(95),t(54)),W=function(){var e,n=Object(s.useReducer)(p,h),t=Object(j.a)(n,2),c=t[0],r=t[1],o=Object(s.useState)(null),i=Object(j.a)(o,2),l=i[0],f=i[1],m=s.useMemo((function(){return[c,r,l]}),[c,l]),g=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({type:"set_me",payload:{me:{id:Date.now().toString(),name:c.nameValue}}});case 2:return r(x(!0)),e.t0=f,e.next=6,new WebSocket("ws://ws-simple-chat-api.herokuapp.com");case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(l&&(l.onmessage=function(e){r(w(JSON.parse(e.data)))},l.onopen=function(){r(v(!0));var e={event:O.CONNECTION,id:c.me.id,name:c.nameValue,body:""};null===l||void 0===l||l.send(JSON.stringify(e)),r(x(!1)),console.log("ws on")},l.onmessage=function(e){var n=JSON.parse(e.data);r(w(n)),console.log("message send")},l.onclose=function(){r(v(!1));var e={event:O.CONNECTION,id:c.me.id,name:c.nameValue,body:""};console.log("ws close"),l.send(JSON.stringify(e))},l.onerror=function(){r(v(!1)),setTimeout((function(){return g()}),1e3),console.log("ws error")}),c.isLoading)return Object(_.jsx)(J,{});var b=(null===(e=c.nameValue)||void 0===e?void 0:e.trim().length)<3;return Object(_.jsx)(M.a,{children:Object(_.jsxs)(a.Provider,{value:m,children:[Object(_.jsx)(S,{}),c.isConnected?Object(_.jsx)(G,{}):Object(_.jsx)(_.Fragment,{children:Object(_.jsxs)(E.a,{container:!0,justifyContent:"center",alignItems:"stretch",children:[Object(_.jsx)(I.a,{variant:"filled",onChange:function(e){return r(function(e){return{type:"set_name_value",payload:{nameValue:e}}}(e.currentTarget.value))},value:c.nameValue}),Object(_.jsx)(k.a,{disabled:b,color:"info",onClick:g,variant:"contained",children:"connect"})]})})]})})};o.a.render(Object(_.jsx)(c.a.StrictMode,{children:Object(_.jsx)(W,{})}),document.getElementById("root")),i()}},[[96,1,2]]]);
//# sourceMappingURL=main.a2286769.chunk.js.map